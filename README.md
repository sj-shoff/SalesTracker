# SalesTracker

## Описание проекта

SalesTracker — это веб-приложение для учёта доходов и расходов с функциями аналитики и экспорта данных. Сервис позволяет управлять финансовыми транзакциями, получать агрегированную статистику по периодам и формировать отчёты в формате CSV.

## Функциональные возможности

### Управление записями

Сервис поддерживает полный цикл операций CRUD для финансовых транзакций:

- Создание новых записей о доходах и расходах
- Просмотр списка всех записей с пагинацией
- Редактирование существующих записей
- Удаление записей
- Фильтрация по типу, категории и периоду

### Аналитика

Система предоставляет раздельную аналитику для доходов и расходов:

- Расчёт суммы операций за период
- Вычисление среднего значения
- Подсчёт количества записей
- Расчёт медианы
- Вычисление 90-го перцентиля
- Детализация записей за выбранный период

### Экспорт данных

- Формирование отчётов в формате CSV
- Выбор периода для экспорта
- Включение аналитических данных в отчёт
- Корректное отображение кириллицы в Excel

## Технологический стек

- Go 1.24+
- Docker и Docker Compose

## Архитектура проекта

Проект следует принципам чистой архитектуры с разделением на слои:

- cmd — точка входа приложения
- internal/app — инициализация приложения
- internal/config — конфигурация
- internal/domain — доменные модели
- internal/http-server — HTTP-слой (handlers, router, middleware, dto)
- internal/repository — слой репозитория
- internal/usecase — бизнес-логика
- static — фронтенд ресурсы (css, js, templates)
- migrations — миграции базы данных

## Установка и запуск

### Требования

- Docker и Docker Compose
- Go 1.24+

### Быстрый старт

Клонирование репозитория:

```bash
git clone https://github.com/sj-shoff/SalesTracker.git
cd sales-tracker
```

Настройка переменных окружения:

```bash
cp .env.example .env
```

Запуск сервиса:

```bash
make docker-up
```

Открытие приложения в браузере:

```
http://localhost:8036
```


## Конфигурация

Переменные окружения настраиваются через файл .env


## API Reference

### Items

- GET /items — получение списка записей с пагинацией
- POST /items — создание новой записи
- GET /items/{id} — получение записи по идентификатору
-PUT /items/{id} — обновление записи
- DELETE /items/{id} — удаление записи
- GET /items/export — экспорт данных в CSV

### Analytics

- GET /analytics — получение аналитики за период

Параметры запроса аналитики:

- from — начало периода в формате RFC3339 (обязательный)
- to — конец периода в формате RFC3339 (обязательный)

### Формат запроса создания записи

```json
{
    "type": "income",
    "amount": 1000.00,
    "date": "2025-01-15T10:00:00Z",
    "category": "Зарплата",
    "description": "Февраль"
}
```

### Формат ответа аналитики

```json
{
    "income": {
        "sum": 10000.00,
        "avg": 2000.00,
        "count": 5,
        "median": 1800.00,
        "percent90": 2500.00
    },
    "expense": {
        "sum": 6000.00,
        "avg": 1200.00,
        "count": 5,
        "median": 1000.00,
        "percent90": 1500.00
    },
    "details": []
}
```

## Структура базы данных

### Таблица items

- id — SERIAL PRIMARY KEY, уникальный идентификатор
- type — VARCHAR(50), тип операции (income или expense)
- amount — DECIMAL(10,2), сумма операции
- date — TIMESTAMPTZ, дата и время операции
- category — VARCHAR(100), категория операции
- description — TEXT, описание операции
- created_at — TIMESTAMPTZ, дата создания записи
- updated_at — TIMESTAMPTZ, дата обновления записи

### Индексы

- idx_items_date — индекс по полю date
-idx_items_amount — индекс по полю amount
- idx_items_category — индекс по полю category

## Формат CSV-отчёта

Отчёт содержит три раздела:

1. Заголовок отчёта с указанием периода
2. Аналитика доходов (сумма, среднее, количество, медиана, 90-й перцентиль)
3. Аналитика расходов (сумма, среднее, количество, медиана, 90-й перцентиль)
4. Таблица операций с детализацией

Разделитель полей — точка с запятой. Кодировка — UTF-8 с BOM для корректного отображения кириллицы в Excel.

## Ограничения

- Максимальный период для аналитики — 365 дней
- Сумма операции не может быть отрицательной
- Тип операции должен быть income или expense
- Лимит записей на страницу — 100